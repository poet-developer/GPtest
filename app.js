(function () {
  const input = document.getElementById("userInput");
  const btn = document.getElementById("submitBtn");
  const status = document.getElementById("status");
  const output = document.getElementById("output");
  const emotions = document.getElementById("emotions");

  let loading = false;
  let loadingStep = "idle";

  const sleep = (ms) => new Promise((r) => setTimeout(r, ms));

  async function handleSubmit() {
    const value = input.value.trim();
    if (!value || loading) return;

    if (
      value ===
      `ë‚˜ ê°€ì§„ ê²ƒ íƒ„ì‹ë°–ì— ì—†ì–´
ì €ë…ê±°ë¦¬ë§ˆë‹¤ ë¬¼ë„ëŸ¬ë¯¸ ì²­ì¶˜ì„ ì„¸ì›Œ ë‘ê³ 
ì‚´ì•„ì˜¨ ë‚ ë“¤ì„ ì‹ ê¸°í•˜ê²Œ ì„¸ì–´ ë³´ì•˜ìœ¼ë‹ˆ
ê·¸ ëˆ„êµ¬ë„ ë‚˜ë¥¼ ë‘ë ¤ì›Œí•˜ì§€ ì•Šì•˜ìœ¼ë‹ˆ
ë‚´ í¬ë§ì˜ ë‚´ìš©ì€ ì§ˆíˆ¬ë¿ì´ì—ˆêµ¬ë‚˜
ê·¸ë¦¬í•˜ì—¬ ë‚˜ëŠ” ìš°ì„  ì—¬ê¸°ì— ì§§ì€ ê¸€ì„ ë‚¨ê²¨ ë‘”ë‹¤
ë‚˜ì˜ ìƒì€ ë¯¸ì¹œ ë“¯ì´ ì‚¬ë‘ì„ ì°¾ì•„ í—¤ë§¤ì—ˆìœ¼ë‚˜
ë‹¨ í•œ ë²ˆë„ ìŠ¤ìŠ¤ë¡œë¥¼ ì‚¬ë‘í•˜ì§€ ì•Šì•˜ë…¸ë¼`
    ) {
      loading = true;
      loadingStep = "thinking";
      btn.disabled = true;
      output.textContent = "";
      render();

      await sleep(2000);
      loadingStep = "writing";
      render();

      await sleep(3000);
      emotions.textContent = `
      {'ìŠ¬í””': 0.931,
      'ì•ˆíƒ€ê¹Œì›€/ì‹¤ë§': 0.925,
      'ì„œëŸ¬ì›€': 0.91,
      'ê¹¨ë‹¬ìŒ': 0.85,
      'íŒ¨ë°°/ìê¸°í˜ì˜¤': 0.681,
      'í˜ë“¦/ì§€ì¹¨': 0.655,
      'ë¶ˆì•ˆ/ê±±ì •': 0.646,
      'ë¶ˆìŒí•¨/ì—°ë¯¼': 0.619,
      'ë¹„ì¥í•¨': 0.541,
      'í•œì‹¬í•¨': 0.525,
      'ì ˆë§': 0.488,
      'ë¶€ë‹´/ì•ˆ_ë‚´í‚´': 0.45,
      'ë¶ˆí‰/ë¶ˆë§Œ': 0.416,
      'ë‹¹í™©/ë‚œì²˜': 0.383,
      'ë¶€ë„ëŸ¬ì›€': 0.363,
      'ì£„ì±…ê°': 0.345,
      'ì˜ì‹¬/ë¶ˆì‹ ': 0.303}
      `;
      output.textContent = `
    ë‚˜ëŠ” ì§€ê¸ˆ ì–´ë””ì¯¤ ì„œ ìˆëŠ”ê°€ 
    ë‹¬ë¹›ì— ì –ì€ ë‚™ì—½ ê°™ì€ ì¡´ì¬ë¡œ 
    ë°œëë¶€í„° ì„œì„œíˆ ìŠ¤ë©°ë“œëŠ” ì°¨ê°€ìš´ ê¸°ìš´ ëŠë¼ë©° 
    ë¹ˆì†ìœ¼ë¡œ ê±¸ì–´ì˜¨ ê¸´ ì—¬ì • ë˜ëŒì•„ë³¸ë‹¤

    íƒ„ì‹ ë°–ì— ë‚¨ì€ ê²ƒì´ ì—†ë˜ ê·¸ë‚ ë“¤ 
    ì²­ì¶˜ì´ë¼ëŠ” ì´ë¦„í‘œ ë‹¬ì•„ë‘ê³  
    ë§¤ì¼ê°™ì´ ê±°ìš¸ ì•ì—ì„œ ì„œì„±ì´ë˜ ì‹œê°„ë“¤ 
    ëˆ„êµ¬ë„ ë‘ë ¤ì›Œí–ˆë˜ ì ì€ ì—†ì—ˆì§€ë§Œ 
    ë§ˆìŒì†ì—” ëŠ˜ ëˆ„êµ°ê°€ì— ëŒ€í•œ ì§ˆíˆ¬ë§Œ ê°€ë“í–ˆìœ¼ë‹ˆ 

    ì‚¬ë‘ì„ ì°¾ì•„ ì´ë¦¬ ë›°ê³  ì €ë¦¬ ë›°ë˜ ë°œê±¸ìŒì´ì—ˆìœ¼ë‚˜ 
    ì •ì‘ ìê¸° ìì‹ ì´ë€ ê½ƒ í•œ ì†¡ì´ í”¼ì›Œë‚´ì§€ ëª»í•œ ë¯¸ë ¨í•¨ 
    ì„¸ìƒì˜ ì£ëŒ€ì— ì´ë¦¬ì €ë¦¬ íœ˜ë‘˜ë¦¬ë©° ì‚´ì•„ì˜¨ ì„¸ì›”ë“¤ì´ 
    ì´ì œ ì™€ì„œ ë³´ë‹ˆ ëª¨ë‘ ë¶€ì§ˆì—†ë‹¤ ëŠê»´ì§„ë‹¤

    ê°€ìŠ´ í•œê°€ìš´ë° ëš«ë¦° êµ¬ë©ê°™ì€ ê³µí—ˆí•¨ 
    ì•„ë¬´ë¦¬ ì±„ì›Œë³´ë ¤ í•´ë„ ë©”ì›Œì§€ì§€ ì•ŠëŠ” ê²°í•ê° 
    ì–´ë‘  ì†ì—ì„œ í™€ë¡œ ë¹›ì„ ì°¾ëŠ” ë°˜ë”§ë¶ˆì´ì²˜ëŸ¼ 
    í¬ë§ì´ë¼ëŠ” ë“±ë¶ˆë§Œ ë“¤ê³  ì •ì²˜ì—†ì´ ë– ëŒì•˜ë˜ ë‚ ë“¤

    ê·¸ë˜ë„ ì–´ì©Œê² ë‚˜ ì´ëŸ° ê²Œ ì‚¶ì¸ê°€ ë³´ë‹¤ 
    ìƒì²˜íˆ¬ì„±ì´ ë°œë°‘ì— ìŒ“ì´ëŠ” ë¨¼ì§€ë“¤ ë³´ë©° 
    ì–¸ì  ê°€ í™ìœ¼ë¡œ ëŒì•„ê°ˆ ìˆœê°„ ê¸°ë‹¤ë¦¬ë©° 
    ì˜¤ëŠ˜ë„ ë¬µë¬µíˆ ê±¸ì–´ê°€ì•¼ í•  ê¸¸ì¼ í…Œë‹ˆ
    `;

      loading = false;
      loadingStep = "idle";
      btn.disabled = false;
      render();
    } else {
      output.textContent = "ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.";
    }
  }

  function render() {
    if (loading && loadingStep === "thinking") {
      status.textContent = "ğŸ’¡ ì˜ê°ì„ ë°›ëŠ”ì¤‘...";
    } else if (loading && loadingStep === "writing") {
      status.textContent = "âœï¸ ì‹œë¥¼ ì§“ëŠ”ì¤‘...";
    } else {
      status.textContent = "";
    }
  }

  btn.addEventListener("click", handleSubmit);
  input.addEventListener("keydown", (e) => {
    if (e.key === "Enter") handleSubmit();
  });
})();
